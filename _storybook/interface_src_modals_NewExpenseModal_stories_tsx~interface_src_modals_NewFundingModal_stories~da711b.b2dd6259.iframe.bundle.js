(self.webpackChunk_monetr_stories=self.webpackChunk_monetr_stories||[]).push([["interface_src_modals_NewExpenseModal_stories_tsx~interface_src_modals_NewFundingModal_stories~da711b"],{"../interface/src/components/MSelectFrequency.tsx":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return l}});var u=t("../node_modules/react/jsx-runtime.js"),r=t("../node_modules/react/index.js"),a=t("../node_modules/formik/dist/formik.esm.js"),s=t.ir(t("../interface/src/components/MSelect.tsx")),c=t.ir(t("../interface/src/components/Recurrence/getRecurrencesForDate.ts"));function l(e){let[n,t]=(0,r.useState)(null),l=(0,a.useFormikContext)(),d=l.values[e.dateFrom],o=(0,c.default)(d);(0,r.useEffect)(()=>{console.debug("[MSelectFrequency]","date selection has changed and is no longer present in the rules");let n=l?.values[e.name],u=n?o.findIndex(e=>e.equalRule(n)):-1;if(u>=0){console.debug("[MSelectFrequency]","found existing recurrence with the specified value"),t(u);return}t(null),l?.setFieldValue(e.name,null),l?.validateField(e.name)},[d]);let i=o.map((e,n)=>({label:e.name,value:n})),f=null!==n&&n>=0&&n<i.length?i[n]:{label:"Select a frequency...",value:-1};return(0,u.jsx)(s.default,{...e,disabled:l?.isSubmitting,error:l?.errors[e.name],isClearable:!1,label:e.label,name:e.name,onChange:function(n,u){t(n.value),l?.setFieldValue(e.name,o[n.value].ruleString()),l?.setFieldTouched(e.name,!0),l?.validateField(e.name)},options:i,value:f})}},"../interface/src/modals/NewFundingModal.tsx":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});!function(e,n){for(var t in n)Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}(n,{default:function(){return S},showNewFundingModal:function(){return _}});var u=t("../node_modules/react/jsx-runtime.js"),r=t("../node_modules/react/index.js"),a=t.ir(t("../node_modules/@ebay/nice-modal-react/lib/esm/index.js")),s=t("../node_modules/notistack/notistack.esm.js"),c=t.ir(t("../interface/src/components/MButton.tsx")),l=t.ir(t("../interface/src/components/MDatePicker.tsx")),d=t.ir(t("../interface/src/components/MForm.tsx")),o=t.ir(t("../interface/src/components/MModal.tsx")),i=t.ir(t("../interface/src/components/MSelectFrequency.tsx")),f=t.ir(t("../interface/src/components/MSpan.tsx")),m=t.ir(t("../interface/src/components/MTextField.tsx")),h=t("../node_modules/date-fns/esm/index.js"),g=t("../interface/src/hooks/bankAccounts.ts"),b=t("../interface/src/hooks/fundingSchedules.ts"),y=t.ir(t("../interface/src/models/FundingSchedule.ts"));let p={name:"",nextOccurrence:(0,h.startOfTomorrow)(),ruleset:"",excludeWeekends:!1,estimatedDeposit:void 0},x=a.default.create(function(){let e=(0,a.useModal)(),n=(0,r.useRef)(null),{enqueueSnackbar:t}=(0,s.useSnackbar)(),x=(0,g.useSelectedBankAccountId)(),S=(0,b.useCreateFundingSchedule)();async function _(n,u){u.setSubmitting(!0);let r=new y.default({bankAccountId:x,name:n.name,nextOccurrence:(0,h.startOfDay)(new Date(n.nextOccurrence)),ruleset:n.ruleset,estimatedDeposit:null,excludeWeekends:!1});return S(r).then(n=>e.resolve(n)).then(()=>e.remove()).catch(e=>void t(e.response.data.error,{variant:"error",disableWindowBlurListener:!0})).finally(()=>u.setSubmitting(!1))}return(0,u.jsx)(o.default,{open:e.visible,ref:n,className:"py-4 md:max-w-sm",children:(0,u.jsx)(d.default,{initialValues:p,onSubmit:_,className:"h-full flex flex-col gap-2 p-2 justify-between","data-testid":"new-funding-modal",children:(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)(f.default,{className:"font-bold text-xl mb-2",children:"Create A New Funding Schedule"}),(0,u.jsx)(m.default,{id:"funding-name-search",name:"name",label:"What do you want to call your funding schedule?",required:!0,autoComplete:"off",placeholder:"Example: Payday..."}),(0,u.jsx)(l.default,{name:"nextOccurrence",label:"When do you get paid next?",required:!0,min:(0,h.startOfTomorrow)()}),(0,u.jsx)(i.default,{dateFrom:"nextOccurrence",menuPosition:"fixed",menuShouldScrollIntoView:!1,menuShouldBlockScroll:!0,menuPortalTarget:document.body,menuPlacement:"bottom",label:"How often do you get paid?",placeholder:"Select a funding frequency...",required:!0,name:"ruleset"}),(0,u.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,u.jsx)(c.default,{color:"cancel",onClick:e.remove,"data-testid":"close-new-funding-modal",children:"Cancel"}),(0,u.jsx)(c.default,{color:"primary",type:"submit",children:"Create"})]})]})})})});var S=x;function _(){return a.default.show(x)}},"../interface/src/components/Recurrence/Recurrence.ts":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return r}});var u=t("../node_modules/rrule/dist/esm/index.js");class r{name;rule;constructor(e){e&&Object.assign(this,e)}ruleString(){return this.rule.toString()}equalRule(e){try{let n=(0,u.rrulestr)(e);n.options.dtstart=null,n.options.byhour=null,n.options.byminute=null,n.options.bysecond=null,n.options.tzid=null;let t=this.rule.clone();t.options.dtstart=null,t.options.byhour=null,t.options.byminute=null,t.options.bysecond=null,n.options.tzid=null;let r=JSON.stringify(n.options),a=JSON.stringify(t.options);return r===a}catch{return console.warn("cannot compare invalid rrules",e,this),!1}}}},"../interface/src/components/Recurrence/getRecurrencesForDate.ts":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return s}});var u=t.ir(t("../interface/src/components/Recurrence/Recurrence.ts")),r=t("../node_modules/date-fns/esm/index.js"),a=t("../node_modules/rrule/dist/esm/index.js");function s(e){let n;if("string"==typeof e)n=(0,r.parseJSON)(e);else{if(!e)return[];n=e}let t=(0,r.startOfDay)(n),s=(0,r.startOfDay)((0,r.endOfMonth)(t)),l=(0,r.startOfDay)((0,r.startOfMonth)(t)),d=(0,r.isEqual)(t,l),o=(0,r.isEqual)(t,s),i=(0,r.format)(t,"EEEE"),f=function(e){switch((0,r.format)(e,"EEEE")){case"Monday":return a.RRule.MO;case"Tuesday":return a.RRule.TU;case"Wednesday":return a.RRule.WE;case"Thursday":return a.RRule.TH;case"Friday":return a.RRule.FR;case"Saturday":return a.RRule.SA;default:return a.RRule.SU}}(t),m=o?" last day of the month":c((0,r.getDate)(t)),h=[new u.default({name:`Every ${i}`,rule:new a.RRule({dtstart:t,freq:a.RRule.WEEKLY,interval:1,byweekday:[f]})}),new u.default({name:`Every other ${i}`,rule:new a.RRule({dtstart:t,freq:a.RRule.WEEKLY,interval:2,byweekday:[f]})}),new u.default({name:`Every month on the ${m}`,rule:new a.RRule({dtstart:t,freq:a.RRule.MONTHLY,interval:1,bymonthday:(0,r.getDate)(t)})}),new u.default({name:`Every other month on the ${m}`,rule:new a.RRule({dtstart:t,freq:a.RRule.MONTHLY,interval:2,bymonthday:(0,r.getDate)(t)})}),new u.default({name:`Every 3 months (quarter) on the ${m}`,rule:new a.RRule({dtstart:t,freq:a.RRule.MONTHLY,interval:3,bymonthday:(0,r.getDate)(t)})}),new u.default({name:`Every 6 months on the ${m}`,rule:new a.RRule({dtstart:t,freq:a.RRule.MONTHLY,interval:6,bymonthday:(0,r.getDate)(t)})}),new u.default({name:`Every year on the ${c((0,r.getDate)(t))} of ${(0,r.format)(t,"MMMM")}`,rule:new a.RRule({dtstart:t,freq:a.RRule.YEARLY,interval:1,bymonth:(0,r.getMonth)(t)+1,bymonthday:(0,r.getDate)(t)})})];return(d||15===(0,r.getDate)(t))&&h.push(new u.default({name:"1st and 15th of every month",rule:new a.RRule({dtstart:t,freq:a.RRule.MONTHLY,interval:1,bymonthday:[1,15]})})),(o||15===(0,r.getDate)(t))&&h.push(new u.default({name:"15th and last day of every month",rule:new a.RRule({dtstart:t,freq:a.RRule.MONTHLY,interval:1,bymonthday:[15,-1]})})),h}function c(e){let n=e%10,t=e%100;return 1===n&&11!==t?`${e}st`:2===n&&12!==t?`${e}nd`:3===n&&13!==t?`${e}rd`:`${e}th`}},"../interface/src/hooks/fundingSchedules.ts":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});!function(e,n){for(var t in n)Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}(n,{useFundingSchedulesSink:function(){return l},useNextFundingDate:function(){return d},useFundingSchedule:function(){return o},useCreateFundingSchedule:function(){return i},useUpdateFundingSchedule:function(){return f},useRemoveFundingSchedule:function(){return m}});var u=t("../node_modules/@tanstack/react-query/build/lib/index.mjs"),r=t("../node_modules/date-fns/esm/index.js"),a=t("../interface/src/hooks/bankAccounts.ts"),s=t.ir(t("../interface/src/models/FundingSchedule.ts")),c=t.ir(t("../interface/src/util/request.ts"));function l(){let e=(0,a.useSelectedBankAccountId)();return(0,u.useQuery)([`/bank_accounts/${e}/funding_schedules`],{enabled:!!e,select:e=>e.map(e=>new s.default(e))})}function d(){let{data:e}=l(),n=e?.sort((e,n)=>(0,r.isBefore)(e.nextOccurrence,n.nextOccurrence)?1:-1).pop();return n?(0,r.format)(n.nextOccurrence,"M/dd"):null}function o(e){let n=(0,a.useSelectedBankAccountId)();return(0,u.useQuery)([`/bank_accounts/${n}/funding_schedules/${e}`],{enabled:!!n&&!!e,select:e=>e?.fundingScheduleId?new s.default(e):null})}function i(){let e=(0,u.useQueryClient)();async function n(e){return(0,c.default)().post(`/bank_accounts/${e.bankAccountId}/funding_schedules`,e).then(e=>new s.default(e?.data))}let t=(0,u.useMutation)(n,{onSuccess:n=>Promise.all([e.setQueriesData([`/bank_accounts/${n.bankAccountId}/funding_schedules`],e=>e.concat(n)),e.setQueriesData([`/bank_accounts/${n.bankAccountId}/funding_schedules/${n.fundingScheduleId}`],n)])});return t.mutateAsync}function f(){let e=(0,u.useQueryClient)();async function n(e){return(0,c.default)().put(`/bank_accounts/${e.bankAccountId}/funding_schedules/${e.fundingScheduleId}`,e).then(e=>e.data)}let t=(0,u.useMutation)(n,{onSuccess:n=>Promise.all([e.setQueriesData([`/bank_accounts/${n.fundingSchedule.bankAccountId}/funding_schedules`],e=>e.map(e=>e.fundingScheduleId===n.fundingSchedule.fundingScheduleId?n.fundingSchedule:e)),e.setQueriesData([`/bank_accounts/${n.fundingSchedule.bankAccountId}/funding_schedules/${n.fundingSchedule.fundingScheduleId}`],n.fundingSchedule),e.setQueriesData([`/bank_accounts/${n.fundingSchedule.bankAccountId}/spending`],e=>e.map(e=>(n.spending||[]).find(n=>n.spendingId===e.spendingId)||e)),(n.spending||[]).map(t=>e.setQueriesData([`/bank_accounts/${n.fundingSchedule.bankAccountId}/spending/${t.spendingId}`],t)),e.invalidateQueries([`/bank_accounts/${n.fundingSchedule.bankAccountId}/forecast`]),e.invalidateQueries([`/bank_accounts/${n.fundingSchedule.bankAccountId}/forecast/next_funding`])])});return t.mutateAsync}function m(){let e=(0,u.useQueryClient)();async function n(e){return(0,c.default)().delete(`/bank_accounts/${e.bankAccountId}/funding_schedules/${e.fundingScheduleId}`).then(()=>e)}let t=(0,u.useMutation)(n,{onSuccess:({bankAccountId:n,fundingScheduleId:t})=>Promise.all([e.setQueriesData([`/bank_accounts/${n}/funding_schedules`],e=>e.filter(e=>e.fundingScheduleId!==t)),e.removeQueries([`/bank_accounts/${n}/funding_schedules/${t}`])])});return t.mutateAsync}},"../interface/src/models/FundingSchedule.ts":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"default",{enumerable:!0,get:function(){return r}});var u=t("../node_modules/date-fns/esm/index.js");class r{fundingScheduleId;bankAccountId;name;description;ruleset;lastOccurrence;nextOccurrence;nextOccurrenceOriginal;excludeWeekends;estimatedDeposit;constructor(e){e&&Object.assign(this,{...e,lastOccurrence:e.lastOccurrence&&(0,u.parseJSON)(e.lastOccurrence),nextOccurrence:(0,u.parseJSON)(e.nextOccurrence),nextOccurrenceOriginal:(0,u.parseJSON)(e.nextOccurrenceOriginal)})}}}}]);
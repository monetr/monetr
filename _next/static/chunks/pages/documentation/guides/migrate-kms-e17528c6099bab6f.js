(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4996],{4231:(e,i,r)=>{"use strict";r.r(i),r.d(i,{default:()=>d,useTOC:()=>l});var n=r(6514),s=r(7017),t=r(808),a=r(9493),h=r(4299),o=r(5148);function l(e){return[{value:"Migrating KMS Providers",id:"migrating-kms-providers",depth:2},{value:"Other Notes",id:"other-notes",depth:2}]}let d=(0,s.e)(function(e){let{toc:i=l(e)}=e,r={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",p:"p",pre:"pre",span:"span",strong:"strong",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h1,{children:"Introduction"}),"\n",(0,n.jsxs)(r.p,{children:["This guide exists primarily to help users if they are using the ",(0,n.jsx)(r.a,{href:"/documentation/configure/kms/#vault-transit-configuration",children:"Vault\nTransit"})," KMS provider for their self-hosted instances of\nmonetr. This provider is being deprecated in an upcoming release and it is recommended to move to OpenBao instead. This\nguide will cover migrating from any provider you currently have configured to the OpenBao KMS provider."]}),"\n",(0,n.jsx)(h.P,{type:"warning",children:(0,n.jsx)(r.p,{children:"It is always recommended to make a backup of monetr’s data before performing a migration like this. While this\nmigration should be non-destructive up until the final steps, it is always possible that the dry run succeeds and the\nactual migration may fail. While monetr does try to perform the migration atomically such that there is no data loss\neven in the event of a failure, it is always better to be safe and have a backup just incase."})}),"\n",(0,n.jsx)(r.h2,{id:i[0].id,children:i[0].value}),"\n",(0,n.jsxs)(o.g,{children:[(0,n.jsx)("h3",{children:"Getting Started"}),(0,n.jsx)(r.p,{children:"To get started with the migration, you first need to make sure you have both the current encryption provider and the new\ndesired encryption provider configured in your configuration file for monetr. For example, if you are moving from\nVault to OpenBao your configuration file should look like this:"}),(0,n.jsx)(r.pre,{tabIndex:"0","data-language":"yaml","data-word-wrap":"","data-filename":"config.yaml",children:(0,n.jsxs)(r.code,{children:[(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"# ..."})}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"keyManagement"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"  provider"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"vault"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"  vault"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    keyId"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"monetr"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    authMethod"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"token"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    endpoint"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"http://vault:80"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"  openbao"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    keyId"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"monetr"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    authMethod"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"token"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    endpoint"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"http://openbao:80"})]}),"\n",(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"# ..."})})]})}),(0,n.jsx)(r.p,{children:"This configuration file example indicates that the current configured provider is Vault but both the Vault and OpenBao\nproviders are configured."}),(0,n.jsx)("h3",{children:"Dry Run"}),(0,n.jsxs)(r.p,{children:["Once you have configured both KMS providers you can perform a dry run of the migration. This dry run will test that\nmonetr can use both the new and old KMS provider, and will read all of the secrets from the database and re-encrypt them\nusing the new KMS provider but ",(0,n.jsx)(r.em,{children:"will not store them again"}),". This way the functionality of the new KMS provider can be\nvalidated without the potential loss of any data."]}),(0,n.jsx)(h.P,{type:"warning",children:(0,n.jsx)(r.p,{children:"Some KMS providers charge per encrypt or decrypt operation performed. This dry run will perform several operations for\nevery secret currently stored on your monetr instance. Depending on your KMS provider this may incur additional\ncharges. Please be aware of this before proceeding."})}),(0,n.jsx)(r.p,{children:"Inside your monetr container run the following command:"}),(0,n.jsx)(h.P,{type:"info",children:(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"Note"}),": Before running this command, you will need to make sure that your config is either stored in the default\nlocation for monetr or you will need to pass ",(0,n.jsx)(r.code,{children:"-c ${path to your config}"})," to monetr before the ",(0,n.jsx)(r.code,{children:"admin"})," command.\nFor example: ",(0,n.jsx)(r.code,{children:"monetr -c ${path to your config} admin ..."}),"."]})}),(0,n.jsx)(r.pre,{tabIndex:"0","data-language":"shell","data-word-wrap":"",children:(0,n.jsx)(r.code,{children:(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"monetr"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:" admin"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:" kms:migrate"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" --from-provider=vault"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" --to-provider=openbao"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" --dry-run"})]})})}),(0,n.jsx)(r.p,{children:"This command will perform the test migration from one KMS provider to another. If there are any problems, monetr will\nprovide some information about the problem it encountered and print some debug information to potentially help resolve\nthe issue. If a problem is encountered then monetr will stop the dry run and not proceed."}),(0,n.jsx)(r.p,{children:"If the dry run completes successfully though, then that means the migration will be successful and you can proceed to\nthe next step."}),(0,n.jsx)("h3",{children:"Migrate Secrets"}),(0,n.jsx)(r.p,{children:"You can now proceed to migrate the secrets for monetr, however this migration cannot be done without downtime and\nrequires that monetr is taken down briefly in order to complete the migration properly. Before proceeding you should\nshut down the monetr server or halt any HTTP traffic to the monetr server while the migration is being performed. This\nis to avoid the situation where a user attempts to perform an action that requires accessing a secret such as updating\ntheir Plaid link or receiving a Plaid webhook."}),(0,n.jsxs)(r.p,{children:["To perform the migration, simply re-run the command you had run in the dry-run but without the ",(0,n.jsx)(r.code,{children:"--dry-run"})," flag. Once\nagain, include any additional configuration flags necessary for your own deployment."]}),(0,n.jsx)(r.pre,{tabIndex:"0","data-language":"shell","data-word-wrap":"",children:(0,n.jsx)(r.code,{children:(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"monetr"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:" admin"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:" kms:migrate"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" --from-provider=vault"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" --to-provider=openbao"})]})})}),(0,n.jsx)("h3",{children:"Update Configuration"}),(0,n.jsx)(r.p,{children:"Once the migration is completed you can modify your configuration file to point to the new provider. Using the example\nconfiguration file from above our updated config would look like this:"}),(0,n.jsx)(r.pre,{tabIndex:"0","data-language":"yaml","data-word-wrap":"","data-filename":"config.yaml",children:(0,n.jsxs)(r.code,{children:[(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"# ..."})}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"keyManagement"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"  provider"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"openbao"})]}),"\n",(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"  # This block can be removed entirely, but has been simply commented out here"})}),"\n",(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"  # for simplicity"})}),"\n",(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"  # vault:"})}),"\n",(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"  #   keyId: monetr"})}),"\n",(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"  #   authMethod: token"})}),"\n",(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"  #   endpoint: http://vault:80"})}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"  openbao"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:":"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    keyId"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"monetr"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    authMethod"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"token"})]}),"\n",(0,n.jsxs)(r.span,{children:[(0,n.jsx)(r.span,{style:{"--shiki-light":"#22863A","--shiki-dark":"#85E89D"},children:"    endpoint"}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,n.jsx)(r.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"http://openbao:80"})]}),"\n",(0,n.jsx)(r.span,{children:(0,n.jsx)(r.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"# ..."})})]})}),(0,n.jsx)(r.p,{children:"Note that the provider has been updated to reflect our new KMS, this is required because the secrets now stored in our\ndatabase are no longer able to be decrypted with our previous KMS provider."}),(0,n.jsx)("h3",{children:"Restart monetr"}),(0,n.jsx)(r.p,{children:"Once your configuration file has been updated, you should restart monetr’s server in order to pick up the new\nconfiguration values."}),(0,n.jsx)(r.p,{children:"In order to test to make sure everything is working properly you can attempt a manual Plaid sync or other operation that\nutilizes secrets."})]}),"\n",(0,n.jsx)(r.h2,{id:i[1].id,children:i[1].value}),"\n",(0,n.jsxs)(r.p,{children:["If you are currently using the ",(0,n.jsx)(r.code,{children:"plaintext"})," KMS provider, then there is no configuration block you need to include for\nthis provider. You only need to include the new provider’s configuration block (such as ",(0,n.jsx)(r.code,{children:"aws"})," or ",(0,n.jsx)(r.code,{children:"openbao"}),") in order to\nmigrate your non-encrypted secrets to encrypted ones."]}),"\n",(0,n.jsx)(r.p,{children:"At the time of writing this, only Plaid secrets as well as some other third party secrets are being encrypted using the\nKMS provider here. If you are managing your budgeting entirely manually or through file uploads, then your usage does\nnot require using a KMS provider at this time."})]})},"/documentation/guides/migrate-kms",{filePath:"src/pages/documentation/guides/migrate-kms.mdx",timestamp:1767907319e3,pageMap:t.O,frontMatter:{title:"Migrate KMS Provider",description:"This guide explains how you can migrate monetr from one KMS provider to another without losing any data."},title:"Migrate KMS Provider"},"undefined"==typeof RemoteContent?l:RemoteContent.useTOC)},4299:(e,i,r)=>{"use strict";r.d(i,{P:()=>o});var n=r(6514),s=r(3367),t=r(3413);let a={default:"\uD83D\uDCA1",error:"\uD83D\uDEAB",info:(0,n.jsx)(t.KS,{className:"_mt-1"}),warning:"⚠️"},h={default:(0,s.A)("_border-orange-100 _bg-orange-50 _text-orange-800 dark:_border-orange-400/30 dark:_bg-orange-400/20 dark:_text-orange-300"),error:(0,s.A)("_border-red-200 _bg-red-100 _text-red-900 dark:_border-red-200/30 dark:_bg-red-900/30 dark:_text-red-200"),info:(0,s.A)("_border-blue-200 _bg-blue-100 _text-blue-900 dark:_border-blue-200/30 dark:_bg-blue-900/30 dark:_text-blue-200"),warning:(0,s.A)("_border-yellow-100 _bg-yellow-50 _text-yellow-900 dark:_border-yellow-200/30 dark:_bg-yellow-700/30 dark:_text-yellow-200")};function o({children:e,type:i="default",emoji:r=a[i]}){return(0,n.jsxs)("div",{className:(0,s.A)("nextra-callout _overflow-x-auto _mt-6 _flex _rounded-lg _border _py-2 ltr:_pr-4 rtl:_pl-4","contrast-more:_border-current contrast-more:dark:_border-current",h[i]),children:[(0,n.jsx)("div",{className:"_select-none _text-xl ltr:_pl-3 ltr:_pr-2 rtl:_pr-3 rtl:_pl-2",style:{fontFamily:'"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},children:r}),(0,n.jsx)("div",{className:"_w-full _min-w-0 _leading-7",children:e})]})}},4426:(e,i,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/documentation/guides/migrate-kms",function(){return r(4231)}])},5148:(e,i,r)=>{"use strict";r.d(i,{g:()=>a});var n=r(6514),s=r(3367),t=r(5834);function a({children:e,className:i,style:r,...a}){let h=(0,t.useId)().replaceAll(":","");return(0,n.jsx)("div",{className:(0,s.A)("nextra-steps _ms-4 _mb-12 _border-s _border-gray-200 _ps-6","dark:_border-neutral-800",i),style:{...r,"--counter-id":h},...a,children:e})}}},e=>{e.O(0,[7017,808,636,6593,8792],()=>e(e.s=4426)),_N_E=e.O()}]);